<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Temps App</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {font-family:Arial,sans-serif;max-width:500px;margin:2rem auto;padding:1rem;background:#f9f9fb;}
    h1 {text-align:center;color:#2c3e50;}
    form {margin:2rem 0;text-align:center;}
    select, input {padding:0.8rem;font-size:1.6rem;border:2px solid #3498db;border-radius:8px;margin:0.5rem;}
    input {width:120px;text-align:center;}
    button {padding:0.8rem 1.4rem;background:#3498db;color:#fff;border:none;border-radius:8px;cursor:pointer;margin-left:1rem;}
    #status {text-align:center;margin:1rem 0;font-weight:bold;font-size:1.2rem;}
  </style>
</head>
<body>

  <h1>Daily High Forecast</h1>
  <p style="text-align:center;">Forecast today’s high in your city of choice</p>

  <form id="tempsForm">
    <div>
      <label>
        City:<br>
        <select id="citySelect" required>
          <option value="">Choose city</option>
          <option value="1">NYC</option>
          <option value="2">LA</option>
          <option value="3">AUS</option>
        </select>
      </label>
    </div>

    <div style="margin-top:1rem;">
      <label>
        Your Forecast (°F):<br>
        <input type="number" id="high" min="-25" max="125" step="1" required placeholder="0">
      </label>
    </div>

    <button type="submit">Confirm</button>
  </form>

  <div id="status"></div>

  <script>
    const SUPABASE_URL = 'https://ckyqknlxmjqlkqnxhgef.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNreXFrbmx4bWpxbGtxbnhoZ2VmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MDEwNjksImV4cCI6MjA4MDQ3NzA2OX0.KPzrKD3TW1CubAQhHyo5oJV0xQ_GLxBG96FSDfTN6p0';

    const { createClient } = supabase;
    const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    document.getElementById('tempsForm').addEventListener('submit', async e => {
      e.preventDefault();

      const cityId = document.getElementById('citySelect').value;
      const guess  = document.getElementById('high').value.trim();

      if (!cityId || !guess) {
        document.getElementById('status').innerHTML = '<span style="color:red;">Pick a city and enter a guess!</span>';
        return;
      }

      const today = new Date().toISOString().split('T')[0];

      const { error } = await client
        .from('daily_forecasts')
        .insert({
          user_id: 1,
          city_id: Number(cityId),
          date: today,
          forecast: Number(guess)
        });

      if (error) {
        document.getElementById('status').innerHTML = `<span style="color:red;">${error.message}</span>`;
      } else {
        document.getElementById('status').innerHTML = `<span style="color:green;">Saved! ${guess}°F for city #${cityId}</span>`;
      }
    });
  </script>
</body>
</html>
