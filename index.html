<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Temps App</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {font-family:Arial,sans-serif;max-width:500px;margin:2rem auto;padding:1rem;background:#f9f9fb;}
    h1 {text-align:center;color:#2c3e50;}
    form {margin:2rem 0;text-align:center;}
    input {padding:0.8rem;font-size:1.6rem;width:120px;border:2px solid #3498db;border-radius:8px;text-align:center;}
    button {padding:0.8rem 1.4rem;background:#3498db;color:#fff;border:none;border-radius:8px;cursor:pointer;margin-left:1rem;}
    #status {text-align:center;margin:1rem 0;font-weight:bold;}
  </style>
</head>
<body>

  <h1>KNYC Daily High Forecast</h1>
  <p style="text-align:center;">Forecast today’s high in NYC.</p>

  <form id="tempsForm">
    <label>
      Your Forecast (°F):
      <input type="number" id="knyc_high" min="-25" max="125" step="1" required placeholder="53">
    </label>
    <button type="submit">Confirm</button>
  </form>

  <div id="status"></div>

  <script>
    // ←←← REPLACE THESE TWO LINES WITH YOUR REAL VALUES ←←←
    const SUPABASE_URL = 'https://ckyqknlxmjqlkqnxhgef.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNreXFrbmx4bWpxbGtxbnhoZ2VmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MDEwNjksImV4cCI6MjA4MDQ3NzA2OX0.KPzrKD3TW1CubAQhHyo5oJV0xQ_GLxBG96FSDfTN6p0';
    // ←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←

    const supabase = window.Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Load last guess for this user (temp user 1)
    async function loadLastGuess() {
      const { data, error } = await supabase
        .from('daily_forecasts')
        .select('forecast')
        .eq('user_id', 1)
        .order('date', { ascending: false })
        .limit(1);

      if (data && data[0]) {
        document.getElementById('knyc_high').value = data[0].forecast;
      }
    }

    // Save new guess
    async function saveForecast(guess) {
      const today = new Date().toISOString().split('T')[0];

      const { error } = await supabase
        .from('daily_forecasts')
        .upsert({
          user_id: 1,           // temporary user
          date: today,
          city_id: 1,
          forecast: Number(guess)
        }, { onConflict: 'user_id,date,city_id' });  // updates if same day

      if (error) {
        document.getElementById('status').innerHTML = `<span style="color:red;">Error: ${error.message}</span>`;
      } else {
        document.getElementById('status').innerHTML = `<span style="color:green;">Saved! ${guess}°F</span>`;
      }
    }

    // Form submit
    document.getElementById('tempsForm').addEventListener('submit', async e => {
      e.preventDefault();
      const guess = document.getElementById('knyc_high').value.trim();
      if (!guess) return;
      await saveForecast(guess);
    });

    // Load last guess on page load
    loadLastGuess();
  </script>
</body>
</html>
